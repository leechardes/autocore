# Config-App Frontend - Makefile
# React + Vite + shadcn/ui

# VariÃ¡veis
NODE = node
NPM = npm
VITE = npx vite
SHADCN = npx shadcn@latest

# DiretÃ³rios
DIST_DIR = dist
SRC_DIR = src
PUBLIC_DIR = public

# Cores para output
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[1;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

.PHONY: help
help: ## Mostra este menu de ajuda
	@echo "$(BLUE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(BLUE)â•‘     Config-App Frontend - Makefile        â•‘$(NC)"
	@echo "$(BLUE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(GREEN)Comandos disponÃ­veis:$(NC)"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  $(YELLOW)%-20s$(NC) %s\n", $$1, $$2}'
	@echo ""
	@echo "$(BLUE)Exemplos de uso:$(NC)"
	@echo "  make install    # Configura ambiente completo"
	@echo "  make dev        # Executa em modo desenvolvimento"
	@echo "  make build      # Build para produÃ§Ã£o"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SETUP E INSTALAÃ‡ÃƒO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: check-node
check-node: ## Verifica se Node.js estÃ¡ instalado
	@echo "$(GREEN)ğŸ” Verificando Node.js...$(NC)"
	@$(NODE) --version || (echo "$(RED)âŒ Node.js nÃ£o encontrado. Instale Node.js 16+$(NC)" && exit 1)
	@echo "âœ… Node.js OK"

.PHONY: install
install: check-node ## Instala todas as dependÃªncias
	@echo "$(GREEN)ğŸ“¦ Instalando dependÃªncias...$(NC)"
	@$(NPM) install
	@echo "âœ… DependÃªncias instaladas"
	@echo ""
	@echo "$(GREEN)ğŸ“ Configurando ambiente...$(NC)"
	@if [ ! -f .env ]; then \
		echo "VITE_API_BASE_URL=http://localhost:8000" > .env; \
		echo "âœ… Arquivo .env criado"; \
	else \
		echo "â„¹ï¸  Arquivo .env jÃ¡ existe"; \
	fi

.PHONY: install-dev
install-dev: install ## Instala dependÃªncias + ferramentas de dev
	@echo "$(GREEN)ğŸ”§ Instalando ferramentas de desenvolvimento...$(NC)"
	@$(NPM) install --save-dev prettier eslint
	@echo "âœ… Ferramentas de dev instaladas"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EXECUÃ‡ÃƒO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: dev
dev: ## Executa em modo desenvolvimento (com HMR)
	@echo "$(GREEN)ğŸš€ Iniciando servidor de desenvolvimento...$(NC)"
	@echo "ğŸ“¡ AplicaÃ§Ã£o disponÃ­vel em: http://localhost:3000"
	@echo "ğŸ”„ Hot Module Reload habilitado"
	@echo ""
	@$(NPM) run dev

.PHONY: build
build: ## Build para produÃ§Ã£o
	@echo "$(GREEN)ğŸ—ï¸ Gerando build de produÃ§Ã£o...$(NC)"
	@$(NPM) run build
	@echo "âœ… Build gerado em $(DIST_DIR)/"
	@echo ""
	@echo "$(GREEN)ğŸ“Š EstatÃ­sticas do bundle:$(NC)"
	@ls -lh $(DIST_DIR)/ || echo "DiretÃ³rio $(DIST_DIR)/ nÃ£o encontrado"

.PHONY: preview
preview: ## Preview do build de produÃ§Ã£o
	@echo "$(GREEN)ğŸ‘ï¸ Preview do build de produÃ§Ã£o...$(NC)"
	@echo "ğŸ“¡ Preview disponÃ­vel em: http://localhost:3000"
	@$(NPM) run preview

.PHONY: serve
serve: build ## Build e servir localmente
	@echo "$(GREEN)ğŸŒ Servindo build de produÃ§Ã£o...$(NC)"
	@$(NPM) run preview

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# QUALIDADE DE CÃ“DIGO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: lint
lint: ## Verifica cÃ³digo com ESLint
	@echo "$(GREEN)ğŸ” Verificando cÃ³digo com ESLint...$(NC)"
	@$(NPM) run lint

.PHONY: format
format: ## Formata cÃ³digo com Prettier
	@echo "$(GREEN)ğŸ¨ Formatando cÃ³digo...$(NC)"
	@$(NPM) run format

.PHONY: check
check: lint ## Verifica qualidade do cÃ³digo
	@echo "$(GREEN)âœ… VerificaÃ§Ã£o de qualidade concluÃ­da$(NC)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SHADCN/UI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: ui-add
ui-add: ## Adiciona componente shadcn/ui (uso: make ui-add COMPONENT=button)
	@if [ -z "$(COMPONENT)" ]; then \
		echo "$(RED)âŒ Especifique o componente: make ui-add COMPONENT=button$(NC)"; \
		exit 1; \
	fi
	@echo "$(GREEN)ğŸ“¦ Adicionando componente: $(COMPONENT)$(NC)"
	@$(SHADCN) add $(COMPONENT)
	@echo "âœ… Componente $(COMPONENT) adicionado"

.PHONY: ui-update
ui-update: ## Atualiza todos os componentes shadcn/ui
	@echo "$(GREEN)ğŸ”„ Atualizando componentes shadcn/ui...$(NC)"
	@$(SHADCN) update
	@echo "âœ… Componentes atualizados"

.PHONY: ui-list
ui-list: ## Lista componentes shadcn/ui disponÃ­veis
	@echo "$(GREEN)ğŸ“ Componentes shadcn/ui disponÃ­veis:$(NC)"
	@echo ""
	@echo "$(YELLOW)BÃ¡sicos:$(NC) button, input, label, textarea, select"
	@echo "$(YELLOW)Layout:$(NC) card, separator, sheet, dialog, drawer"
	@echo "$(YELLOW)NavegaÃ§Ã£o:$(NC) tabs, breadcrumb, pagination"
	@echo "$(YELLOW)Feedback:$(NC) alert, badge, progress, toast"
	@echo "$(YELLOW)Forms:$(NC) checkbox, radio-group, switch, slider"
	@echo "$(YELLOW)AvanÃ§ados:$(NC) table, calendar, popover, tooltip"
	@echo ""
	@echo "Uso: $(BLUE)make ui-add COMPONENT=button$(NC)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TESTES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: test-build
test-build: ## Testa se build funciona corretamente
	@echo "$(GREEN)ğŸ§ª Testando build...$(NC)"
	@$(NPM) run build
	@echo "âœ… Build OK"

.PHONY: test-api
test-api: ## Testa conexÃ£o com API
	@echo "$(GREEN)ğŸ” Testando API...$(NC)"
	@echo "$(YELLOW)GET /api/status$(NC)"
	@curl -s http://localhost:8000/api/status | python3 -c "import sys, json; print(json.dumps(json.load(sys.stdin), indent=2))" || echo "âŒ API nÃ£o disponÃ­vel"

.PHONY: test-responsiveness
test-responsiveness: ## Lista breakpoints para testar responsividade
	@echo "$(GREEN)ğŸ“± Breakpoints para testes:$(NC)"
	@echo ""
	@echo "$(YELLOW)Mobile:$(NC)     320px, 375px, 414px"
	@echo "$(YELLOW)Tablet:$(NC)     768px, 1024px"
	@echo "$(YELLOW)Desktop:$(NC)    1280px, 1440px, 1920px"
	@echo ""
	@echo "Use DevTools para testar cada breakpoint"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DEPLOY
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: deploy-check
deploy-check: ## Verifica se estÃ¡ pronto para deploy
	@echo "$(GREEN)ğŸš€ Verificando deploy readiness...$(NC)"
	@echo -n "âœ“ Package.json existe: "; test -f package.json && echo "OK" || echo "FALHOU"
	@echo -n "âœ“ Vite config existe: "; test -f vite.config.js && echo "OK" || echo "FALHOU"
	@echo -n "âœ“ Tailwind config existe: "; test -f tailwind.config.js && echo "OK" || echo "FALHOU"
	@echo -n "âœ“ shadcn/ui config existe: "; test -f components.json && echo "OK" || echo "FALHOU"
	@echo -n "âœ“ Build funciona: "; $(NPM) run build >/dev/null 2>&1 && echo "OK" || echo "FALHOU"

.PHONY: deploy-pi
deploy-pi: build ## Deploy para Raspberry Pi (uso: make deploy-pi PI_HOST=pi@raspberrypi.local)
	@if [ -z "$(PI_HOST)" ]; then \
		echo "$(RED)âŒ Especifique o host: make deploy-pi PI_HOST=pi@raspberrypi.local$(NC)"; \
		exit 1; \
	fi
	@echo "$(GREEN)ğŸš€ Deploy para Raspberry Pi...$(NC)"
	@echo "ğŸ“¡ Host: $(PI_HOST)"
	@scp -r $(DIST_DIR)/* $(PI_HOST):/var/www/autocore/ || \
		(echo "$(RED)âŒ Falha no deploy. Verifique SSH e diretÃ³rio$(NC)" && exit 1)
	@echo "âœ… Deploy concluÃ­do"
	@echo "ğŸŒ Acesse: http://$(shell echo $(PI_HOST) | cut -d@ -f2)"

.PHONY: deploy-local
deploy-local: build ## Deploy local (copia para diretÃ³rio especÃ­fico)
	@echo "$(GREEN)ğŸ“ Deploy local...$(NC)"
	@read -p "DiretÃ³rio de destino: " DEST_DIR; \
	if [ -n "$$DEST_DIR" ]; then \
		cp -r $(DIST_DIR)/* "$$DEST_DIR/"; \
		echo "âœ… Arquivos copiados para $$DEST_DIR"; \
	else \
		echo "$(RED)âŒ DiretÃ³rio nÃ£o especificado$(NC)"; \
	fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIMPEZA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: clean
clean: ## Remove arquivos temporÃ¡rios e builds
	@echo "$(GREEN)ğŸ§¹ Limpando arquivos temporÃ¡rios...$(NC)"
	@rm -rf $(DIST_DIR)
	@rm -rf node_modules/.vite
	@rm -rf .eslintcache
	@echo "âœ… Arquivos temporÃ¡rios removidos"

.PHONY: clean-deps
clean-deps: ## Remove node_modules
	@echo "$(RED)âš ï¸ Removendo dependÃªncias...$(NC)"
	@rm -rf node_modules
	@rm -f package-lock.json
	@echo "âœ… DependÃªncias removidas"

.PHONY: clean-all
clean-all: clean clean-deps ## Remove tudo (deps e temporÃ¡rios)
	@echo "$(GREEN)âœ… Limpeza completa realizada$(NC)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DESENVOLVIMENTO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: deps-update
deps-update: ## Atualiza dependÃªncias
	@echo "$(GREEN)ğŸ”„ Atualizando dependÃªncias...$(NC)"
	@$(NPM) update
	@echo "âœ… DependÃªncias atualizadas"

.PHONY: deps-check
deps-check: ## Verifica dependÃªncias desatualizadas
	@echo "$(GREEN)ğŸ” Verificando dependÃªncias...$(NC)"
	@$(NPM) outdated

.PHONY: info
info: ## Mostra informaÃ§Ãµes do ambiente
	@echo "$(BLUE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(BLUE)â•‘         InformaÃ§Ãµes do Ambiente            â•‘$(NC)"
	@echo "$(BLUE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(GREEN)VersÃµes:$(NC)"
	@echo "  Node.js: $$($(NODE) --version)"
	@echo "  NPM:     $$($(NPM) --version)"
	@echo ""
	@echo "$(GREEN)DiretÃ³rios:$(NC)"
	@echo "  Source:  $(SRC_DIR)/"
	@echo "  Build:   $(DIST_DIR)/"
	@echo "  Public:  $(PUBLIC_DIR)/"
	@echo ""
	@echo "$(GREEN)Scripts disponÃ­veis:$(NC)"
	@$(NPM) run | grep -E "^  " | head -10

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ATALHOS ÃšTEIS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: start
start: install dev ## Setup e executa (alias para install + dev)

.PHONY: fresh
fresh: clean-all install ## Reset completo do ambiente

.PHONY: prod
prod: build preview ## Build e preview de produÃ§Ã£o

.PHONY: ship
ship: clean build deploy-check ## Preparar para produÃ§Ã£o

# Default target
.DEFAULT_GOAL := help